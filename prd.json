{
  "project": "NutritionAI",
  "branchName": "ralph/nutrition-analyzer-mvp",
  "description": "AI-Powered Nutrition Analyzer Mobile App - iOS app with photo-based food nutrition analysis",
  "userStories": [
    {
      "id": "US-001",
      "title": "Initialize iOS project with SwiftUI",
      "description": "As a developer, I need the iOS project scaffolded with SwiftUI and camera capabilities.",
      "acceptanceCriteria": [
        "Create new iOS project with SwiftUI app template",
        "Set minimum iOS deployment target to 16.0",
        "Add Info.plist entry: NSCameraUsageDescription",
        "Configure basic navigation structure with ContentView",
        "Project builds successfully without errors",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Initialize Node.js backend with Fastify",
      "description": "As a developer, I need the backend API initialized with TypeScript and Fastify.",
      "acceptanceCriteria": [
        "Initialize Node.js project with TypeScript configuration",
        "Install dependencies: fastify, @fastify/cors, dotenv",
        "Create basic server with GET /health endpoint",
        "Configure CORS to allow mobile app requests",
        "Server starts successfully on port from environment variable",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Set up Prisma database schema",
      "description": "As a developer, I need the database schema for storing meal analysis records.",
      "acceptanceCriteria": [
        "Install and initialize Prisma with PostgreSQL",
        "Create MealAnalysis model with fields: id, userId, imageUrl, nutritionData (JSON), createdAt",
        "Define NutritionData type with calories, protein, carbs, fat fields",
        "Generate Prisma client",
        "Create initial migration file",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Create nutrition data models in Swift",
      "description": "As a developer, I need structured Swift models for nutrition data.",
      "acceptanceCriteria": [
        "Create NutritionData struct with: calories, protein, carbs, fat (all Double)",
        "Create FoodItem struct with: name, portion, confidence (0-1), nutrition",
        "Create MealAnalysis struct combining foods array, totals, timestamp",
        "All structs conform to Codable protocol",
        "Add computed property for macro percentages on NutritionData",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Implement camera preview with AVFoundation",
      "description": "As a user, I want to see a live camera preview when I open the app.",
      "acceptanceCriteria": [
        "Create CameraView with AVFoundation camera preview layer",
        "Request camera permission on first use",
        "Display live camera preview when permission granted",
        "Show permission denied message when permission not granted",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Add photo capture functionality",
      "description": "As a user, I want to capture a photo of my food using the camera.",
      "acceptanceCriteria": [
        "Add capture button to camera view",
        "Capture photo on button tap",
        "Display captured photo in preview",
        "Compress image to under 2MB",
        "Add retake and confirm buttons",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Install and configure Gemini SDK",
      "description": "As a developer, I need Gemini AI SDK integrated in the backend.",
      "acceptanceCriteria": [
        "Install @google/generative-ai package",
        "Configure Gemini API key from environment variable",
        "Create gemini.ts service with initializeModel() function",
        "Add environment variable validation on server start",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Create Gemini nutrition analysis prompt",
      "description": "As a developer, I need an optimized prompt for extracting nutrition data from food images.",
      "acceptanceCriteria": [
        "Create prompt template that requests food identification",
        "Prompt asks for portion size estimation in common units",
        "Prompt requests macro breakdown: calories, protein, carbs, fat per item and total",
        "Specify JSON output format matching NutritionData schema",
        "Include confidence scoring for each food item (0-1)",
        "Document prompt in code comments",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Create image validation utilities",
      "description": "As a developer, I need to validate uploaded images before processing.",
      "acceptanceCriteria": [
        "Validate image format (JPG/PNG only)",
        "Validate image size (max 5MB)",
        "Return clear error messages for invalid images",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 9,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Implement POST /api/analyze endpoint",
      "description": "As a backend developer, I need an endpoint that accepts images and returns nutrition analysis.",
      "acceptanceCriteria": [
        "Install @fastify/multipart for file uploads",
        "Create POST /api/analyze route accepting multipart/form-data",
        "Use image validation from US-009",
        "Send image to Gemini with nutrition prompt",
        "Parse Gemini response into structured JSON",
        "Add timeout handling (30 seconds max)",
        "Return 200 with nutrition data or 4xx/5xx with error message",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 10,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Create API service in iOS app",
      "description": "As a developer, I need a service to communicate with the backend API.",
      "acceptanceCriteria": [
        "Create APIService class with async/await methods",
        "Implement analyzeImage() method that sends image to POST /api/analyze",
        "Use URLSession with multipart/form-data encoding",
        "Decode response into MealAnalysis model",
        "Handle network errors and timeouts gracefully",
        "Add timeout handling (30 seconds)",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Create nutrition summary card component",
      "description": "As a developer, I need a reusable component to display nutrition totals.",
      "acceptanceCriteria": [
        "Create NutritionSummaryCard SwiftUI view",
        "Display total calories prominently",
        "Show protein, carbs, fat in grams",
        "Display macro percentages",
        "Use adaptive colors for Dark Mode",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Create food item list component",
      "description": "As a developer, I need a component to display individual food items.",
      "acceptanceCriteria": [
        "Create FoodItemCard SwiftUI view",
        "Display food name and portion size",
        "Show individual nutrition values",
        "Display confidence score with color coding",
        "Use adaptive colors for Dark Mode",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Build nutrition results view",
      "description": "As a user, I want to see the nutritional breakdown of my food after capture.",
      "acceptanceCriteria": [
        "Create NutritionResultView using NutritionSummaryCard and FoodItemCard components",
        "Add loading indicator during API call",
        "Show error message if analysis fails",
        "Add dismiss/retry button",
        "Integrate into CameraView confirm button flow",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Implement local storage service with Core Data",
      "description": "As a developer, I need to save meal analyses locally for history.",
      "acceptanceCriteria": [
        "Create StorageService using Core Data (iOS 16+ compatible)",
        "Define StoredMealAnalysis entity with nutritionData, thumbnail, timestamp",
        "Implement save() method for storing analyses",
        "Implement fetch methods for retrieving history",
        "Data persists across app restarts",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Add auto-pruning to storage service",
      "description": "As a developer, I need to limit stored history to prevent excessive storage use.",
      "acceptanceCriteria": [
        "Implement auto-prune to keep maximum 100 entries",
        "Delete oldest entries when limit exceeded",
        "Auto-prune runs after each save",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-017",
      "title": "Integrate storage service into camera flow",
      "description": "As a user, I want my analyzed meals saved automatically.",
      "acceptanceCriteria": [
        "Call StorageService.save() after successful analysis in CameraView",
        "Store nutrition data and thumbnail image",
        "Handle storage errors gracefully without blocking user",
        "Typecheck passes"
      ],
      "priority": 17,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-018",
      "title": "Extend backend to save analyses to database",
      "description": "As a developer, I need meal analyses stored in PostgreSQL.",
      "acceptanceCriteria": [
        "Install pg and @prisma/adapter-pg packages",
        "Initialize PrismaClient with PostgreSQL adapter",
        "Extend POST /api/analyze to save analysis to database",
        "Store userId (placeholder), imageUrl (empty), nutritionData JSON, timestamp",
        "Return analysis ID in API response",
        "Handle database errors gracefully",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 18,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-019",
      "title": "Create history item card component",
      "description": "As a developer, I need a component to display history list items.",
      "acceptanceCriteria": [
        "Create HistoryItemCard SwiftUI view",
        "Display total calories and timestamp",
        "Show food item count",
        "Display thumbnail or placeholder icon",
        "Use adaptive colors for Dark Mode",
        "Typecheck passes"
      ],
      "priority": 19,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-020",
      "title": "Create history list view",
      "description": "As a user, I want to view a list of my previously analyzed meals.",
      "acceptanceCriteria": [
        "Create HistoryView showing meals in reverse chronological order",
        "Use LazyVStack for smooth scrolling performance",
        "Show empty state when no history exists",
        "Tapping item shows full nutrition details in sheet",
        "Make MealAnalysis Identifiable for sheet presentation",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 20,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-021",
      "title": "Add tab navigation between camera and history",
      "description": "As a user, I want to easily switch between camera and history views.",
      "acceptanceCriteria": [
        "Create TabView in ContentView with Camera and History tabs",
        "Use SF Symbols icons: camera.fill and clock.fill",
        "Tab selection persists when switching",
        "Camera view resets captured image when navigating away",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 21,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-022",
      "title": "Add camera permission error handling",
      "description": "As a user, I want clear guidance when camera access is denied.",
      "acceptanceCriteria": [
        "Show alert when camera permission is denied",
        "Alert includes button to open Settings app",
        "Display permission denied view in camera screen",
        "Handle permission request on first app launch",
        "No app crash when permission denied",
        "Typecheck passes"
      ],
      "priority": 22,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-023",
      "title": "Add network error handling",
      "description": "As a user, I want clear feedback when network requests fail.",
      "acceptanceCriteria": [
        "Add noInternetConnection case to APIError enum",
        "Detect offline state (notConnectedToInternet, networkConnectionLost)",
        "Show user-friendly error messages without exposing internals",
        "Display retry button on errors",
        "Log all errors for debugging",
        "Typecheck passes"
      ],
      "priority": 23,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-024",
      "title": "Add backend rate limiting",
      "description": "As a developer, I need to prevent API abuse with rate limiting.",
      "acceptanceCriteria": [
        "Install @fastify/rate-limit package",
        "Configure rate limit: 100 requests per hour per IP",
        "Return 429 status when limit exceeded",
        "Include retry-after header in response",
        "Log rate limit violations",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 24,
      "passes": true,
      "notes": ""
    }
  ]
}
